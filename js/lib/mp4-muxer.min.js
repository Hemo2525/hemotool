"use strict";var Mp4Muxer=(()=>{var ve=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var Ke=Object.getOwnPropertyNames;var Ye=Object.prototype.hasOwnProperty;var Ze=(t,e)=>{for(var i in e)ve(t,i,{get:e[i],enumerable:!0})},Je=(t,e,i,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ke(e))!Ye.call(t,n)&&n!==i&&ve(t,n,{get:()=>e[n],enumerable:!(s=qe(e,n))||s.enumerable});return t};var Qe=t=>Je(ve({},"__esModule",{value:!0}),t);var Ae=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)};var r=(t,e,i)=>(Ae(t,e,"read from private field"),i?i.call(t):e.get(t)),h=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},y=(t,e,i,s)=>(Ae(t,e,"write to private field"),s?s.call(t,i):e.set(t,i),i);var p=(t,e,i)=>(Ae(t,e,"access private method"),i);var Lt={};Ze(Lt,{ArrayBufferTarget:()=>K,FileSystemWritableFileStreamTarget:()=>Y,Muxer:()=>be,StreamTarget:()=>P});var f=new Uint8Array(8),B=new DataView(f.buffer),w=t=>[(t%256+256)%256],c=t=>(B.setUint16(0,t,!1),[f[0],f[1]]),Me=t=>(B.setInt16(0,t,!1),[f[0],f[1]]),Oe=t=>(B.setUint32(0,t,!1),[f[1],f[2],f[3]]),o=t=>(B.setUint32(0,t,!1),[f[0],f[1],f[2],f[3]]),Pe=t=>(B.setUint32(0,Math.floor(t/2**32),!1),B.setUint32(4,t,!1),[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7]]),oe=t=>(B.setInt16(0,2**8*t,!1),[f[0],f[1]]),v=t=>(B.setInt32(0,2**16*t,!1),[f[0],f[1],f[2],f[3]]),ke=t=>(B.setInt32(0,2**30*t,!1),[f[0],f[1],f[2],f[3]]),A=(t,e=!1)=>{let i=Array(t.length).fill(null).map((s,n)=>t.charCodeAt(n));return e&&i.push(0),i},U=t=>t&&t[t.length-1],M=(t,e,i=!0)=>{let s=t*e;return i?Math.round(s):s},Be=t=>{let e=t*(Math.PI/180),i=Math.cos(e),s=Math.sin(e);return[i,s,0,-s,i,0,0,0,1]},Ve=Be(0),Ue=t=>[v(t[0]),v(t[1]),ke(t[2]),v(t[3]),v(t[4]),ke(t[5]),v(t[6]),v(t[7]),ke(t[8])],R=t=>!t||typeof t!="object"?t:Array.isArray(t)?t.map(R):Object.fromEntries(Object.entries(t).map(([e,i])=>[e,R(i)]));var b=(t,e,i)=>({type:t,contents:e&&new Uint8Array(e.flat(10)),children:i}),T=(t,e,i,s,n)=>b(t,[w(e),Oe(i),s??[]],n),Le=t=>t?b("ftyp",[A("isom"),o(0),A("iso4"),A("hvc1")]):b("ftyp",[A("isom"),o(0),A("isom"),A("avc1"),A("mp41")]),Ee=t=>({type:"mdat",largeSize:t}),Re=t=>({type:"free",size:t}),ue=(t,e)=>b("moov",null,[et(e,t),...t.map(i=>tt(i,e))]),et=(t,e)=>{let i=M(Math.max(0,...e.filter(n=>n.samples.length>0).map(n=>U(n.samples).timestamp+U(n.samples).duration)),he),s=Math.max(...e.map(n=>n.id))+1;return T("mvhd",0,0,[o(t),o(t),o(he),o(i),v(1),oe(1),Array(10).fill(0),Ue(Ve),Array(24).fill(0),o(s)])},tt=(t,e)=>b("trak",null,[it(t,e),rt(t,e)]),it=(t,e)=>{let i=U(t.samples),s=M(i?i.timestamp+i.duration:0,he);return T("tkhd",0,3,[o(e),o(e),o(t.id),o(0),o(s),Array(8).fill(0),c(0),c(0),oe(t.info.type==="audio"?1:0),c(0),Ue(Be(t.info.type==="video"?t.info.rotation:0)),v(t.info.type==="video"?t.info.width:0),v(t.info.type==="video"?t.info.height:0)])},rt=(t,e)=>b("mdia",null,[st(t,e),nt(t.info.type==="video"?"vide":"soun"),at(t)]),st=(t,e)=>{let i=U(t.samples),s=M(i?i.timestamp+i.duration:0,t.timescale);return T("mdhd",0,0,[o(e),o(e),o(t.timescale),o(s),c(21956),c(0)])},nt=t=>T("hdlr",0,0,[A("mhlr"),A(t),o(0),o(0),o(0),A("mp4-muxer-hdlr")]),at=t=>b("minf",null,[t.info.type==="video"?ot():ht(),ut(),ft(t)]),ot=()=>T("vmhd",0,1,[c(0),c(0),c(0),c(0)]),ht=()=>T("smhd",0,0,[c(0),c(0)]),ut=()=>b("dinf",null,[lt()]),lt=()=>T("dref",0,0,[o(1)],[dt()]),dt=()=>T("url ",0,1),ft=t=>b("stbl",null,[mt(t),wt(t),St(t),vt(t),At(t),kt(t)]),mt=t=>T("stsd",0,0,[o(1)],[t.info.type==="video"?ct(Ot[t.info.codec],t):Ct(Ut[t.info.codec],t)]),ct=(t,e)=>b(t,[Array(6).fill(0),c(1),c(0),c(0),Array(12).fill(0),c(e.info.width),c(e.info.height),o(4718592),o(4718592),o(0),c(1),Array(32).fill(0),c(24),Me(65535)],[Bt[e.info.codec](e)]),pt=t=>t.codecPrivate&&b("avcC",[...t.codecPrivate]),yt=t=>t.codecPrivate&&b("hvcC",[...t.codecPrivate]),bt=t=>t.codecPrivate&&b("vpcC",[...t.codecPrivate]),Tt=t=>t.codecPrivate&&b("av1C",[...t.codecPrivate]),Ct=(t,e)=>b(t,[Array(6).fill(0),c(1),c(0),c(0),o(0),c(e.info.numberOfChannels),c(16),c(0),c(0),v(e.info.sampleRate)],[Et[e.info.codec](e)]),xt=t=>T("esds",0,0,[o(58753152),w(32+t.codecPrivate.byteLength),c(1),w(0),o(75530368),w(18+t.codecPrivate.byteLength),w(64),w(21),Oe(0),o(130071),o(130071),o(92307584),w(t.codecPrivate.byteLength),...t.codecPrivate,o(109084800),w(1),w(2)]),gt=t=>b("dOps",[w(0),w(t.info.numberOfChannels),c(3840),o(t.info.sampleRate),oe(0),w(0)]),wt=t=>T("stts",0,0,[o(t.timeToSampleTable.length),t.timeToSampleTable.map(e=>[o(e.sampleCount),o(e.sampleDelta)])]),St=t=>{if(t.samples.every(i=>i.type==="key"))return null;let e=[...t.samples.entries()].filter(([,i])=>i.type==="key");return T("stss",0,0,[o(e.length),e.map(([i])=>o(i+1))])},vt=t=>T("stsc",0,0,[o(t.compactlyCodedChunkTable.length),t.compactlyCodedChunkTable.map(e=>[o(e.firstChunk),o(e.samplesPerChunk),o(1)])]),At=t=>T("stsz",0,0,[o(0),o(t.samples.length),t.samples.map(e=>o(e.size))]),kt=t=>t.finalizedChunks.length>0&&U(t.finalizedChunks).offset>=2**32?T("co64",0,0,[o(t.finalizedChunks.length),t.finalizedChunks.map(e=>Pe(e.offset))]):T("stco",0,0,[o(t.finalizedChunks.length),t.finalizedChunks.map(e=>o(e.offset))]),Ot={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},Bt={avc:pt,hevc:yt,vp9:bt,av1:Tt},Ut={aac:"mp4a",opus:"opus"},Et={aac:xt,opus:gt};var K=class{constructor(){this.buffer=null}},P=class{constructor(e,i,s){this.onData=e;this.onDone=i;this.options=s}},Y=class{constructor(e,i){this.stream=e;this.options=i}};var _,V,Z=class{constructor(){this.pos=0;h(this,_,new Uint8Array(8));h(this,V,new DataView(r(this,_).buffer));this.offsets=new WeakMap}seek(e){this.pos=e}writeU32(e){r(this,V).setUint32(0,e,!1),this.write(r(this,_).subarray(0,4))}writeU64(e){r(this,V).setUint32(0,Math.floor(e/2**32),!1),r(this,V).setUint32(4,e,!1),this.write(r(this,_).subarray(0,8))}writeAscii(e){for(let i=0;i<e.length;i++)r(this,V).setUint8(i%8,e.charCodeAt(i)),i%8===7&&this.write(r(this,_));e.length%8!==0&&this.write(r(this,_).subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.pos),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.write(e.contents);else{let i=this.pos;if(this.writeBoxHeader(e,0),e.contents&&this.write(e.contents),e.children)for(let a of e.children)a&&this.writeBox(a);let s=this.pos,n=e.size??s-i;this.seek(i),this.writeBoxHeader(e,n),this.seek(s)}}writeBoxHeader(e,i){this.writeU32(e.largeSize?1:i),this.writeAscii(e.type),e.largeSize&&this.writeU64(i)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){let i=this.pos;this.seek(this.offsets.get(e)),this.writeBox(e),this.seek(i)}measureBox(e){if(e.contents&&!e.children)return this.measureBoxHeader(e)+e.contents.byteLength;{let i=this.measureBoxHeader(e);if(e.contents&&(i+=e.contents.byteLength),e.children)for(let s of e.children)s&&(i+=this.measureBox(s));return i}}};_=new WeakMap,V=new WeakMap;var ee,z,N,F,te,De,de=class extends Z{constructor(i){super();h(this,te);h(this,ee,void 0);h(this,z,new ArrayBuffer(2**16));h(this,N,new Uint8Array(r(this,z)));h(this,F,0);y(this,ee,i)}write(i){p(this,te,De).call(this,this.pos+i.byteLength),r(this,N).set(i,this.pos),this.pos+=i.byteLength,y(this,F,Math.max(r(this,F),this.pos))}finalize(){p(this,te,De).call(this,this.pos),r(this,ee).buffer=r(this,z).slice(0,Math.max(r(this,F),this.pos))}};ee=new WeakMap,z=new WeakMap,N=new WeakMap,F=new WeakMap,te=new WeakSet,De=function(i){let s=r(this,z).byteLength;for(;s<i;)s*=2;if(s===r(this,z).byteLength)return;let n=new ArrayBuffer(s),a=new Uint8Array(n);a.set(r(this,N),0),y(this,z,n),y(this,N,a)};var H,I,J=class extends Z{constructor(i){super();h(this,H,void 0);h(this,I,[]);y(this,H,i)}write(i){r(this,I).push({data:i.slice(),start:this.pos}),this.pos+=i.byteLength}flush(){if(r(this,I).length===0)return;let i=[],s=[...r(this,I)].sort((n,a)=>n.start-a.start);i.push({start:s[0].start,size:s[0].data.byteLength});for(let n=1;n<s.length;n++){let a=i[i.length-1],d=s[n];d.start<=a.start+a.size?a.size=Math.max(a.size,d.start+d.data.byteLength-a.start):i.push({start:d.start,size:d.data.byteLength})}for(let n of i){n.data=new Uint8Array(n.size);for(let a of r(this,I))n.start<=a.start&&a.start<n.start+n.size&&n.data.set(a.data,a.start-n.start);r(this,H).onData(n.data,n.start)}r(this,I).length=0}finalize(){r(this,H).onDone?.()}};H=new WeakMap,I=new WeakMap;var Dt=2**24,_t=2,j,S,x,ie,_e,me,Ne,ce,Fe,$,le,Q=class extends Z{constructor(i){super();h(this,ie);h(this,me);h(this,ce);h(this,$);h(this,j,void 0);h(this,S,void 0);h(this,x,[]);if(y(this,j,i),y(this,S,i.options?.chunkSize??Dt),!Number.isInteger(r(this,S))||r(this,S)<2**10)throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(i){p(this,ie,_e).call(this,i,this.pos),p(this,$,le).call(this),this.pos+=i.byteLength}finalize(){p(this,$,le).call(this,!0),r(this,j).onDone?.()}};j=new WeakMap,S=new WeakMap,x=new WeakMap,ie=new WeakSet,_e=function(i,s){let n=r(this,x).findIndex(C=>C.start<=s&&s<C.start+r(this,S));n===-1&&(n=p(this,ce,Fe).call(this,s));let a=r(this,x)[n],d=s-a.start,l=i.subarray(0,Math.min(r(this,S)-d,i.byteLength));a.data.set(l,d);let O={start:d,end:d+l.byteLength};if(p(this,me,Ne).call(this,a,O),a.written[0].start===0&&a.written[0].end===r(this,S)&&(a.shouldFlush=!0),r(this,x).length>_t){for(let C=0;C<r(this,x).length-1;C++)r(this,x)[C].shouldFlush=!0;p(this,$,le).call(this)}l.byteLength<i.byteLength&&p(this,ie,_e).call(this,i.subarray(l.byteLength),s+l.byteLength)},me=new WeakSet,Ne=function(i,s){let n=0,a=i.written.length-1,d=-1;for(;n<=a;){let l=Math.floor(n+(a-n+1)/2);i.written[l].start<=s.start?(n=l+1,d=l):a=l-1}for(i.written.splice(d+1,0,s),(d===-1||i.written[d].end<s.start)&&d++;d<i.written.length-1&&i.written[d].end>=i.written[d+1].start;)i.written[d].end=Math.max(i.written[d].end,i.written[d+1].end),i.written.splice(d+1,1)},ce=new WeakSet,Fe=function(i){let n={start:Math.floor(i/r(this,S))*r(this,S),data:new Uint8Array(r(this,S)),written:[],shouldFlush:!1};return r(this,x).push(n),r(this,x).sort((a,d)=>a.start-d.start),r(this,x).indexOf(n)},$=new WeakSet,le=function(i=!1){for(let s=0;s<r(this,x).length;s++){let n=r(this,x)[s];if(!(!n.shouldFlush&&!i)){for(let a of n.written)r(this,j).onData(n.data.subarray(a.start,a.end),n.start+a.start);r(this,x).splice(s--,1)}}};var fe=class extends Q{constructor(e){super(new P((i,s)=>e.stream.write({type:"write",data:i,position:s}),void 0,{chunkSize:e.options?.chunkSize}))}};var he=1e3,zt=["avc","hevc","vp9","av1"],It=["aac","opus"],Mt=2082844800,Pt=.5,Vt=["strict","offset"],u,m,re,g,E,D,W,X,se,Te,He,Ce,je,xe,$e,ge,We,we,Xe,ne,ze,Se,Ge,G,pe,q,ye,ae,Ie,be=class{constructor(e){h(this,Te);h(this,Ce);h(this,xe);h(this,ge);h(this,we);h(this,ne);h(this,Se);h(this,G);h(this,q);h(this,ae);h(this,u,void 0);h(this,m,void 0);h(this,re,void 0);h(this,g,void 0);h(this,E,null);h(this,D,null);h(this,W,Math.floor(Date.now()/1e3)+Mt);h(this,X,[]);h(this,se,!1);if(p(this,Te,He).call(this,e),e.video=R(e.video),e.audio=R(e.audio),e.fastStart=R(e.fastStart),this.target=e.target,y(this,u,{firstTimestampBehavior:"strict",...e}),e.target instanceof K)y(this,m,new de(e.target));else if(e.target instanceof P)y(this,m,e.target.options?.chunked?new Q(e.target):new J(e.target));else if(e.target instanceof Y)y(this,m,new fe(e.target));else throw new Error(`Invalid target: ${e.target}`);p(this,Ce,je).call(this),p(this,ge,We).call(this)}addVideoChunk(e,i,s){let n=new Uint8Array(e.byteLength);e.copyTo(n),this.addVideoChunkRaw(n,e.type,s??e.timestamp,e.duration,i)}addVideoChunkRaw(e,i,s,n,a){if(p(this,ae,Ie).call(this),!r(this,u).video)throw new Error("No video track declared.");if(typeof r(this,u).fastStart=="object"&&r(this,E).samples.length===r(this,u).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${r(this,u).fastStart.expectedVideoChunks}).`);p(this,ne,ze).call(this,r(this,E),e,i,s,n,a)}addAudioChunk(e,i,s){let n=new Uint8Array(e.byteLength);e.copyTo(n),this.addAudioChunkRaw(n,e.type,s??e.timestamp,e.duration,i)}addAudioChunkRaw(e,i,s,n,a){if(p(this,ae,Ie).call(this),!r(this,u).audio)throw new Error("No audio track declared.");if(typeof r(this,u).fastStart=="object"&&r(this,D).samples.length===r(this,u).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${r(this,u).fastStart.expectedAudioChunks}).`);p(this,ne,ze).call(this,r(this,D),e,i,s,n,a)}finalize(){r(this,E)&&p(this,G,pe).call(this,r(this,E)),r(this,D)&&p(this,G,pe).call(this,r(this,D));let e=[r(this,E),r(this,D)].filter(Boolean);if(r(this,u).fastStart==="in-memory"){let i;for(let n=0;n<2;n++){let a=ue(e,r(this,W)),d=r(this,m).measureBox(a);i=r(this,m).measureBox(r(this,g));let l=r(this,m).pos+d+i;for(let O of r(this,X)){O.offset=l;for(let C of O.sampleData)l+=C.byteLength,i+=C.byteLength}if(l<2**32)break;i>=2**32&&(r(this,g).largeSize=!0)}let s=ue(e,r(this,W));r(this,m).writeBox(s),r(this,g).size=i,r(this,m).writeBox(r(this,g));for(let n of r(this,X)){for(let a of n.sampleData)r(this,m).write(a);n.sampleData=null}}else{let i=r(this,m).offsets.get(r(this,g)),s=r(this,m).pos-i;r(this,g).size=s,r(this,g).largeSize=s>=2**32,r(this,m).patchBox(r(this,g));let n=ue(e,r(this,W));if(typeof r(this,u).fastStart=="object"){r(this,m).seek(r(this,re)),r(this,m).writeBox(n);let a=i-r(this,m).pos;r(this,m).writeBox(Re(a))}else r(this,m).writeBox(n)}p(this,q,ye).call(this),r(this,m).finalize(),y(this,se,!0)}};u=new WeakMap,m=new WeakMap,re=new WeakMap,g=new WeakMap,E=new WeakMap,D=new WeakMap,W=new WeakMap,X=new WeakMap,se=new WeakMap,Te=new WeakSet,He=function(e){if(e.video){if(!zt.includes(e.video.codec))throw new Error(`Unsupported video codec: ${e.video.codec}`);if(e.video.rotation!==void 0&&![0,90,180,270].includes(e.video.rotation))throw new Error(`Invalid video rotation: ${e.video.rotation}. Has to be 0, 90, 180 or 270.`)}if(e.audio&&!It.includes(e.audio.codec))throw new Error(`Unsupported audio codec: ${e.audio.codec}`);if(e.firstTimestampBehavior&&!Vt.includes(e.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${e.firstTimestampBehavior}`);if(typeof e.fastStart=="object"){if(e.video&&e.fastStart.expectedVideoChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(e.audio&&e.fastStart.expectedAudioChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedAudioChunks'.")}else if(![!1,"in-memory"].includes(e.fastStart))throw new Error("'fastStart' option must be false, 'in-memory' or an object.")},Ce=new WeakSet,je=function(){let e=r(this,u).video?.codec==="hevc";if(r(this,m).writeBox(Le(e)),y(this,re,r(this,m).pos),r(this,u).fastStart==="in-memory")y(this,g,Ee(!1));else{if(typeof r(this,u).fastStart=="object"){let i=p(this,xe,$e).call(this);r(this,m).seek(r(this,m).pos+i)}y(this,g,Ee(!0)),r(this,m).writeBox(r(this,g))}p(this,q,ye).call(this)},xe=new WeakSet,$e=function(){if(typeof r(this,u).fastStart!="object")return;let e=0,i=[r(this,u).fastStart.expectedVideoChunks,r(this,u).fastStart.expectedAudioChunks];for(let s of i)s&&(e+=(4+4)*Math.ceil(2/3*s),e+=4*s,e+=(4+4+4)*Math.ceil(2/3*s),e+=4*s,e+=8*s);return e+=4096,e},ge=new WeakSet,We=function(){if(r(this,u).video&&y(this,E,{id:1,info:{type:"video",codec:r(this,u).video.codec,width:r(this,u).video.width,height:r(this,u).video.height,rotation:r(this,u).video.rotation??0},timescale:720,codecPrivate:new Uint8Array(0),samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]}),r(this,u).audio){let e=p(this,we,Xe).call(this,2,r(this,u).audio.sampleRate,r(this,u).audio.numberOfChannels);y(this,D,{id:r(this,u).video?2:1,info:{type:"audio",codec:r(this,u).audio.codec,numberOfChannels:r(this,u).audio.numberOfChannels,sampleRate:r(this,u).audio.sampleRate},timescale:r(this,u).audio.sampleRate,codecPrivate:e,samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]})}},we=new WeakSet,Xe=function(e,i,s){let a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(i),d=s,l="";l+=e.toString(2).padStart(5,"0"),l+=a.toString(2).padStart(4,"0"),a===15&&(l+=i.toString(2).padStart(24,"0")),l+=d.toString(2).padStart(4,"0");let O=Math.ceil(l.length/8)*8;l=l.padEnd(O,"0");let C=new Uint8Array(l.length/8);for(let k=0;k<l.length;k+=8)C[k/8]=parseInt(l.slice(k,k+8),2);return C},ne=new WeakSet,ze=function(e,i,s,n,a,d){let l=n/1e6,O=a/1e6;if(e.firstTimestamp===void 0&&(e.firstTimestamp=l),l=p(this,Se,Ge).call(this,l,e),e.lastTimestamp=l,(!e.currentChunk||l-e.currentChunk.startTimestamp>=Pt)&&(e.currentChunk&&p(this,G,pe).call(this,e),e.currentChunk={startTimestamp:l,sampleData:[],sampleCount:0}),e.currentChunk.sampleData.push(i),e.currentChunk.sampleCount++,d?.decoderConfig?.description&&(e.codecPrivate=new Uint8Array(d.decoderConfig.description)),e.samples.push({timestamp:l,duration:O,size:i.byteLength,type:s}),e.lastTimescaleUnits!==null){let C=M(l,e.timescale,!1),k=Math.round(C-e.lastTimescaleUnits);e.lastTimescaleUnits+=k;let L=U(e.timeToSampleTable);L.sampleCount===1?(L.sampleDelta=k,L.sampleCount++):L.sampleDelta===k?L.sampleCount++:(L.sampleCount--,e.timeToSampleTable.push({sampleCount:2,sampleDelta:k}))}else e.lastTimescaleUnits=0,e.timeToSampleTable.push({sampleCount:1,sampleDelta:M(O,e.timescale)})},Se=new WeakSet,Ge=function(e,i){if(r(this,u).firstTimestampBehavior==="strict"&&i.lastTimestamp===-1&&e!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${e}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(r(this,u).firstTimestampBehavior==="offset"&&(e-=i.firstTimestamp),e<i.lastTimestamp)throw new Error(`Timestamps must be monotonically increasing (went from ${i.lastTimestamp*1e6} to ${e*1e6}).`);return e},G=new WeakSet,pe=function(e){if(e.currentChunk){if((e.compactlyCodedChunkTable.length===0||U(e.compactlyCodedChunkTable).samplesPerChunk!==e.currentChunk.sampleCount)&&e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length+1,samplesPerChunk:e.currentChunk.sampleCount}),e.finalizedChunks.push(e.currentChunk),r(this,X).push(e.currentChunk),r(this,u).fastStart==="in-memory"){e.currentChunk.offset=0;return}e.currentChunk.offset=r(this,m).pos;for(let i of e.currentChunk.sampleData)r(this,m).write(i);e.currentChunk.sampleData=null,p(this,q,ye).call(this)}},q=new WeakSet,ye=function(){r(this,m)instanceof J&&r(this,m).flush()},ae=new WeakSet,Ie=function(){if(r(this,se))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};return Qe(Lt);})();
if (typeof module === "object" && typeof module.exports === "object") Object.assign(module.exports, Mp4Muxer)
